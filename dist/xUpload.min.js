"use strict";!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery||Zepto)}(function($){function iframeUpload(t,i){this.options=$.extend(defaults,i),this.init(t)}function getBtnCSS(t){return{width:$(t).width(),height:$(t).height(),top:$(t).offset().top,left:$(t).offset().left,position:"absolute",opacity:"0",cursor:"pointer","z-index":1e3}}if(!$)return console.warn("xUpload needs jQuery");var defaults={auto:!0,name:"file",accept:"",multiple:!1,url:"/upload",maxSize:4194304,data:{},onSelect:function(t,i){},onSuccess:function(t){},onError:function(t){},onProgress:function(t){}},htmlUpload=function(t,i){this.file="",this.options=$.extend(defaults,i),this.init(t)},iframeNum=0,iframeLoadFirst=0;htmlUpload.prototype={init:function(t){var i=this,o=$('<input type="file" />').css(getBtnCSS(t));i.options.multiple&&o.attr("multiple","multiple"),this.options.accept&&o.attr("accept",this.options.accept),o.on("change",function(t){for(var o=0;o<this.files.length;o++)if(this.files[o].size>=i.options.maxSize)return console.log("Exceed the maximum file limit"),!1;i.file=this.files,i.options.onSelect(t,i.file),i.options.auto&&i.upload()}),$("body").append(o)},upload:function(){var _this=this,formData=new FormData;if(_this.options.multiple)for(var i=0;i<_this.file.length;i++)formData.append(_this.options.name+"[]",_this.file[i]);else formData.append(_this.options.name,_this.file[0]);if(this.options.data)for(var key in this.options.data)formData.append(key,this.options.data[key]);var xhr=new XMLHttpRequest;xhr.open("POST",_this.options.url,!0),xhr.onprogress=function(t){this.options.onProgress(t)},xhr.onload=function(event){if(200==xhr.status){var data=eval("("+xhr.responseText+")");0==data.status?_this.options.onSuccess(data):_this.options.onError()}else _this.onError(xhr.statusText)},xhr.send(formData)}},iframeUpload.prototype={init:function(t){var i=this;iframeNum++;var o=$('<iframe name="iframe_'+iframeNum+'" style="display:none"></iframe>'),e=$('<form method="post" target="iframe_'+iframeNum+'" action="'+i.options.url+'" name="form_'+iframeNum+'" enctype="multipart/form-data"></form>'),n=$('<input type="file" name="'+i.options.name+'" />').css(getBtnCSS(t));n.on("change",function(t){var o=$(this).val();i.options.onSelect(t,o),this.options.auto&&i.upload(this)});for(key in this.options.data)n+='<input type="hidden" name="'+key+'" value="'+this.options.data[key]+'">';e.append(n),o.load(function(){if(0!=iframeLoadFirst){var t=$(this).contents().get(0),o=$(t).find("body").text();"json"==i.options.dataType&&(o=window.eval("("+o+")")),i.options.onSuccess(o)}iframeLoadFirst=1}),$("body").append(o).append(e)},upload:function(t){$(t).parents("form").submit()}},$.fn.xUpload=function(t){return this.each(function(){return window.FormData?new htmlUpload(this,t):new iframeUpload(this,t)})}});